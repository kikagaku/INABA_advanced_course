<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>実装例 &mdash; 応用講座コース  ドキュメント</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/translations.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="– データの前処理と機械学習モデルの構築 –" href="02_00title.html" />
    <link rel="prev" title="問題設定：Bank Marketing" href="01_04_exercise_classification.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> 応用講座コース
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="00_title.html">– Python 速習とテーブルデータの操作 –</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_00_colab.html">Google Colaboratory 実習</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_01_00_data.html">データの理解</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_01_00_python_basic.html">Python 速習とテーブルデータの基本操作</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_01_01_question.html">演習問題</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_04_exercise_classification.html">問題設定：Bank Marketing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">実装例</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ベースモデルの構築">ベースモデルの構築</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#データの前処理">データの前処理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#欠損値処理">欠損値処理</a></li>
<li class="toctree-l4"><a class="reference internal" href="#カテゴリカル変数">カテゴリカル変数</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#モデルの構築">モデルの構築</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Feature-Importance-の確認">Feature Importance の確認</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#データへのアプローチ">データへのアプローチ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#欠損値補完">欠損値補完</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Job-の欠損値補完">Job の欠損値補完</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Age-の欠損値補完">Age の欠損値補完</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Marital-の欠損値補完">Marital の欠損値補完</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Default-の欠損値補完">Default の欠損値補完</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Housing-の欠損値補完">Housing の欠損値補完</a></li>
<li class="toctree-l4"><a class="reference internal" href="#PDays-の欠損値補完">PDays の欠損値補完</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Poutcome-の欠損値補完">Poutcome の欠損値補完</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Loan-の欠損値補完">Loan の欠損値補完</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#精度の検証（1）">精度の検証（1）</a></li>
<li class="toctree-l3"><a class="reference internal" href="#カテゴリカル変数へのアプローチ">カテゴリカル変数へのアプローチ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Label-Encoding">Label Encoding</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#精度の検証(2)">精度の検証(2)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#モデルへのアプローチ">モデルへのアプローチ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Grid-Search-の適用">Grid Search の適用</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#手法へのアプローチ">手法へのアプローチ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#サポートベクターマシン">サポートベクターマシン</a></li>
<li class="toctree-l3"><a class="reference internal" href="#XGBoost">XGBoost</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ハイパーパラメータのチューニング：XGBoost">ハイパーパラメータのチューニング：XGBoost</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ハイパーパラメータチューニング：SVM">ハイパーパラメータチューニング：SVM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#テストデータで評価">テストデータで評価</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Accuracy-の確認">Accuracy の確認</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="02_00title.html">– データの前処理と機械学習モデルの構築 –</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_01_create_feature.html">モデル構築のための特徴量作成</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_02_K-Fold.html">モデルの精度を保証する実装</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_03_XAI.html">説明可能な AI (XAI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_00title.html">– 時系列解析 –</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_01_timeseries_basic.html">時系列データの取り扱い方</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_02_timeseries_analysis.html">自己回帰型モデル</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_00title.html">– 異常検知 –</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_01.html">異常検知とは</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_02_outlier.html">外れ値検知入門</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_03_other_outlier.html">【補足】 外れ値検知 - その他の手法</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_04_ml_base.html">機械学習を用いた異常検知入門</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_05_other_ml_base.html">【補足】機械学習を用いた異常検知 - その他の手法</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_13_nearest_neighbers.html">変化点検知入門</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_17_generation.html">【補足】 生成モデルによる異常部位検知</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_18_auto_encoder.html">【補足】 異常部位検知 - AutoEncoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="99_11ability-test2.html">【補足】 実力テスト - 機械学習セクション</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">応用講座コース</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>実装例</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/src/01_05_bankmarketing.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="実装例">
<h1>実装例<a class="headerlink" href="#実装例" title="この見出しへのパーマリンク"></a></h1>
<p>▼ 本章で使用するデータセット</p>
<p>学習と検証用のデータセットはこちらから<a class="reference external" href="https://drive.google.com/file/d/12ASy6rFUxeko2qWix2wKl-mYkCLJ--bK/view?usp=sharing">bank_train.csv</a>を使用してください。</p>
<p>ここまでのデータの前処理や操作の実装を生かして、実際の問題設定において分類モデルを構築してみましょう。 今回の問題設定では、リクルーティングが成功（success）するか失敗（fail）するかを予測する二値分類モデルとなります。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

plt.style.use(&#39;seaborn&#39;)
</pre></div>
</div>
</div>
<section id="ベースモデルの構築">
<h2>ベースモデルの構築<a class="headerlink" href="#ベースモデルの構築" title="この見出しへのパーマリンク"></a></h2>
<section id="データの前処理">
<h3>データの前処理<a class="headerlink" href="#データの前処理" title="この見出しへのパーマリンク"></a></h3>
<p>まずは必要な前処理のみを適用して、ベースラインとなる学習済みモデルを構築していきます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df = pd.read_csv(&#39;bank_train.csv&#39;)
df.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-4e06ef43-842d-4d4b-8137-e1b9a100e4e1">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>balance</th>
      <th>housing</th>
      <th>loan</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50.0</td>
      <td>entrepreneur</td>
      <td>married</td>
      <td>secondary</td>
      <td>no</td>
      <td>1857</td>
      <td>no</td>
      <td>yes</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>1</th>
      <td>37.0</td>
      <td>technician</td>
      <td>single</td>
      <td>secondary</td>
      <td>no</td>
      <td>363</td>
      <td>yes</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>2</th>
      <td>35.0</td>
      <td>blue-collar</td>
      <td>married</td>
      <td>primary</td>
      <td>no</td>
      <td>422</td>
      <td>yes</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-4e06ef43-842d-4d4b-8137-e1b9a100e4e1')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-4e06ef43-842d-4d4b-8137-e1b9a100e4e1 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-4e06ef43-842d-4d4b-8137-e1b9a100e4e1');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(6416, 12)
</pre></div></div>
</div>
<p>まずは文字列で入っている教師データを、数値に置き換えます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 教師データ確認
df[&#39;result&#39;].value_counts()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
fail       5683
success     733
Name: result, dtype: int64
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 0,1 で補完
df[&#39;result&#39;] = df[&#39;result&#39;].map({&#39;fail&#39;: 0, &#39;success&#39;: 1})
</pre></div>
</div>
</div>
<section id="欠損値処理">
<h4>欠損値処理<a class="headerlink" href="#欠損値処理" title="この見出しへのパーマリンク"></a></h4>
<p><strong>欠損値の確認</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df.isnull().sum()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
age           90
job            3
marital       89
education      0
default       29
balance        0
housing       61
loan         217
pdays         36
previous       0
poutcome     250
result         0
dtype: int64
</pre></div></div>
</div>
<p>まずはベースラインのモデルとして欠損値は全て除去してしまいます。 その精度をベースに前処理や、ハイパーパラメータのチューニングを行なっていきます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#　全ての行を削除
df = df.dropna()
df.isnull().sum()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
age          0
job          0
marital      0
education    0
default      0
balance      0
housing      0
loan         0
pdays        0
previous     0
poutcome     0
result       0
dtype: int64
</pre></div></div>
</div>
</section>
<section id="カテゴリカル変数">
<h4>カテゴリカル変数<a class="headerlink" href="#カテゴリカル変数" title="この見出しへのパーマリンク"></a></h4>
<p>カテゴリカル変数もひとまず、全てOne-Hot Encodingを適用します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 全部 One-Hot Encoding
df = pd.get_dummies(df)
df.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-540c7c53-1135-42e3-99bc-1715f59d3fb6">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>balance</th>
      <th>pdays</th>
      <th>previous</th>
      <th>result</th>
      <th>job_admin.</th>
      <th>job_blue-collar</th>
      <th>job_entrepreneur</th>
      <th>job_housemaid</th>
      <th>job_management</th>
      <th>...</th>
      <th>default_no</th>
      <th>default_yes</th>
      <th>housing_no</th>
      <th>housing_yes</th>
      <th>loan_no</th>
      <th>loan_yes</th>
      <th>poutcome_failure</th>
      <th>poutcome_other</th>
      <th>poutcome_success</th>
      <th>poutcome_unknown</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50.0</td>
      <td>1857</td>
      <td>-1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>37.0</td>
      <td>363</td>
      <td>-1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>35.0</td>
      <td>422</td>
      <td>-1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 34 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-540c7c53-1135-42e3-99bc-1715f59d3fb6')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-540c7c53-1135-42e3-99bc-1715f59d3fb6 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-540c7c53-1135-42e3-99bc-1715f59d3fb6');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
</section>
</section>
<section id="モデルの構築">
<h3>モデルの構築<a class="headerlink" href="#モデルの構築" title="この見出しへのパーマリンク"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>t = df[&#39;result&#39;].values
x = df.drop([&#39;result&#39;], axis=1).values
</pre></div>
</div>
</div>
<p>前処理が少なくて済む決定木でベースモデルを作成します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの宣言
from sklearn.tree import DecisionTreeClassifier
model = DecisionTreeClassifier(random_state=0)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sklearn.model_selection import train_test_split
x_train, x_val, t_train, t_val = train_test_split(x, t, test_size=0.3, random_state=0)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの学習
model.fit(x_train, t_train)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DecisionTreeClassifier(random_state=0)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># ベースモデルの検証
print(model.score(x_train, t_train))
print(model.score(x_val, t_val))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9992494370778083
0.8114419147694104
</pre></div></div>
</div>
</section>
<section id="Feature-Importance-の確認">
<h3>Feature Importance の確認<a class="headerlink" href="#Feature-Importance-の確認" title="この見出しへのパーマリンク"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 特徴量重要度の確認
feature_importance = model.feature_importances_

# 目的変数削除し、説明変数のみとする
labels = df.drop(&#39;result&#39;, axis=1).columns.tolist()

plt.figure(figsize=(10,10))
plt.barh(labels, feature_importance)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;BarContainer object of 33 artists&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_27_1.png" src="../_images/src_01_05_bankmarketing_27_1.png" />
</div>
</div>
<p>ベースモデルの結果から、正解率の値に開きがあり、少し過学習気味のである事がわかります。 下記の3つのアプローチでこの結果を改善できるか試行錯誤してみます。</p>
<ul class="simple">
<li><p>データへのアプローチ（前処理）</p></li>
<li><p>モデルへのアプローチ（ハイパーパラメータのチューニング）</p></li>
<li><p>手法へのアプローチ（手法の選択）</p></li>
</ul>
</section>
</section>
<section id="データへのアプローチ">
<h2>データへのアプローチ<a class="headerlink" href="#データへのアプローチ" title="この見出しへのパーマリンク"></a></h2>
<div class="line-block">
<div class="line">欠損値やカテゴリカル変数へのアプローチを工夫して、精度がどのように変化するのか確認します。</div>
<div class="line">実問題では、基本的には欠損値が含まれていたとしても、推論する必要があります。</div>
<div class="line">そのため、行方向への欠損値除去は用いずにサンプルを保持したまま学習する方が望ましいです。</div>
<div class="line">今回は全ての欠損値を補完していきます。</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># データフレームの読み込み
df2 = pd.read_csv(&#39;/content/bank_train.csv&#39;)
df2.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-b64a076e-915a-4060-a63d-2a7f39e50dae">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>balance</th>
      <th>housing</th>
      <th>loan</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50.0</td>
      <td>entrepreneur</td>
      <td>married</td>
      <td>secondary</td>
      <td>no</td>
      <td>1857</td>
      <td>no</td>
      <td>yes</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>1</th>
      <td>37.0</td>
      <td>technician</td>
      <td>single</td>
      <td>secondary</td>
      <td>no</td>
      <td>363</td>
      <td>yes</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>2</th>
      <td>35.0</td>
      <td>blue-collar</td>
      <td>married</td>
      <td>primary</td>
      <td>no</td>
      <td>422</td>
      <td>yes</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-b64a076e-915a-4060-a63d-2a7f39e50dae')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-b64a076e-915a-4060-a63d-2a7f39e50dae button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-b64a076e-915a-4060-a63d-2a7f39e50dae');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<section id="欠損値補完">
<h3>欠損値補完<a class="headerlink" href="#欠損値補完" title="この見出しへのパーマリンク"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 欠損値の確認
nullsum = df2.isnull().sum()
nullsum
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
age           90
job            3
marital       89
education      0
default       29
balance        0
housing       61
loan         217
pdays         36
previous       0
poutcome     250
result         0
dtype: int64
</pre></div></div>
</div>
<section id="Job-の欠損値補完">
<h4>Job の欠損値補完<a class="headerlink" href="#Job-の欠損値補完" title="この見出しへのパーマリンク"></a></h4>
<p>職業を表す、 <code class="docutils literal notranslate"><span class="pre">job</span></code> の欠損値補完を行います。 まずはデータを確認しましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.figure(figsize=(15, 6))
sns.countplot(df2[&#39;job&#39;])
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/seaborn/_decorators.py:43: FutureWarning: Pass the following variable as a keyword arg: x. From version 0.12, the only valid positional argument will be `data`, and passing other arguments without an explicit keyword will result in an error or misinterpretation.
  FutureWarning
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fcb6c1a8a90&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_35_2.png" src="../_images/src_01_05_bankmarketing_35_2.png" />
</div>
</div>
<p>データの中に <code class="docutils literal notranslate"><span class="pre">unknown</span></code> というものがあるので、そちらで補完しましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df2 = df2.fillna({&#39;job&#39;:&#39;unknown&#39;})
df2.isnull().sum()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
age           90
job            0
marital       89
education      0
default       29
balance        0
housing       61
loan         217
pdays         36
previous       0
poutcome     250
result         0
dtype: int64
</pre></div></div>
</div>
</section>
<section id="Age-の欠損値補完">
<h4>Age の欠損値補完<a class="headerlink" href="#Age-の欠損値補完" title="この見出しへのパーマリンク"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sns.distplot(df2[&#39;age&#39;].dropna())
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fcb6bc4fcd0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_39_2.png" src="../_images/src_01_05_bankmarketing_39_2.png" />
</div>
</div>
<p>データの総数からみて、欠損の値の数が多くないようなので、一度平均値で補完して問題ないか確認します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 平均値で補完
df2 = df2.fillna({&#39;age&#39;:df[&#39;age&#39;].mean()})
sns.distplot(df2[&#39;age&#39;])
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fcb6bb85bd0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_41_2.png" src="../_images/src_01_05_bankmarketing_41_2.png" />
</div>
</div>
<p>分布にも大きな乱れはなく、正規分布に少し近づいた形になりました。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 欠損値の確認
df2.isnull().sum()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
age            0
job            0
marital       89
education      0
default       29
balance        0
housing       61
loan         217
pdays         36
previous       0
poutcome     250
result         0
dtype: int64
</pre></div></div>
</div>
</section>
<section id="Marital-の欠損値補完">
<h4>Marital の欠損値補完<a class="headerlink" href="#Marital-の欠損値補完" title="この見出しへのパーマリンク"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 値の確認
df2[&#39;marital&#39;].unique()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;married&#39;, &#39;single&#39;, &#39;divorced&#39;, nan], dtype=object)
</pre></div></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">martial</span></code> が表しているのは、結婚、独身、離婚の3つのカテゴリーです。</div>
<div class="line">この指標に関しては年齢や職業が大きく関連しているように考えることができそうです。</div>
<div class="line">では、実験的に職業で考えてみましょう。</div>
</div>
<div class="line-block">
<div class="line">まずは <code class="docutils literal notranslate"><span class="pre">crosstab</span></code> （クロス集計表）を使用して数値の関係性を確認してみます。</div>
<div class="line">その前にどの職業で <code class="docutils literal notranslate"><span class="pre">NaN</span></code> なのか確認してみましょう。</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># maritalがNaNのjobのデータを抽出
marital_null = df2[df2[&#39;marital&#39;].isnull()][[&#39;job&#39;, &#39;marital&#39;]]
marital_null.head(2)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-c808f398-4a7b-48ad-b04e-0f1c5187f4ef">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>job</th>
      <th>marital</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>66</th>
      <td>blue-collar</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>69</th>
      <td>blue-collar</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-c808f398-4a7b-48ad-b04e-0f1c5187f4ef')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-c808f398-4a7b-48ad-b04e-0f1c5187f4ef button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-c808f398-4a7b-48ad-b04e-0f1c5187f4ef');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># jobの中でuniqueを確認
marital_null[&#39;job&#39;].unique()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;blue-collar&#39;, &#39;student&#39;], dtype=object)
</pre></div></div>
</div>
<p>blue-collaer か student のいずれかで補完する。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># crosstabで関係性を確認
pd.crosstab(df2[&#39;marital&#39;], df2[&#39;job&#39;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-9cb6c209-2b56-433c-9095-89c5abd784bb">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>job</th>
      <th>admin.</th>
      <th>blue-collar</th>
      <th>entrepreneur</th>
      <th>housemaid</th>
      <th>management</th>
      <th>retired</th>
      <th>self-employed</th>
      <th>services</th>
      <th>student</th>
      <th>technician</th>
      <th>unemployed</th>
      <th>unknown</th>
    </tr>
    <tr>
      <th>marital</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>divorced</th>
      <td>111</td>
      <td>112</td>
      <td>36</td>
      <td>27</td>
      <td>145</td>
      <td>52</td>
      <td>17</td>
      <td>80</td>
      <td>0</td>
      <td>112</td>
      <td>20</td>
      <td>6</td>
    </tr>
    <tr>
      <th>married</th>
      <td>358</td>
      <td>960</td>
      <td>175</td>
      <td>112</td>
      <td>769</td>
      <td>255</td>
      <td>139</td>
      <td>333</td>
      <td>8</td>
      <td>591</td>
      <td>100</td>
      <td>39</td>
    </tr>
    <tr>
      <th>single</th>
      <td>241</td>
      <td>300</td>
      <td>31</td>
      <td>20</td>
      <td>421</td>
      <td>19</td>
      <td>69</td>
      <td>187</td>
      <td>86</td>
      <td>340</td>
      <td>48</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-9cb6c209-2b56-433c-9095-89c5abd784bb')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-9cb6c209-2b56-433c-9095-89c5abd784bb button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-9cb6c209-2b56-433c-9095-89c5abd784bb');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">student</span></code> は <code class="docutils literal notranslate"><span class="pre">single</span></code> である可能性が高そうです。</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">blue-collar</span></code> は <code class="docutils literal notranslate"><span class="pre">married</span></code> で補完が妥当であるように感じます。</div>
</div>
<div class="line-block">
<div class="line">補完は今までの方法ではうまくいきません、条件文を適応する方法はいくつかありますが、</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">loc</span></code> 関数を使用して、特定のデータを切り出し補完する値を代入する方法がわかりやすいかと思います。</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># df.loc[条件文]で取得したいデータを指定　　&gt; martial が null であり、job が student を抽出
df2.loc[(df2[&#39;marital&#39;].isnull()) &amp; (df2[&#39;job&#39;] == &#39;student&#39;)]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-f96d4cfb-f5cf-4a48-a618-031ed85d9db7">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>balance</th>
      <th>housing</th>
      <th>loan</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>516</th>
      <td>31.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>tertiary</td>
      <td>no</td>
      <td>4951</td>
      <td>no</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>547</th>
      <td>26.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>secondary</td>
      <td>no</td>
      <td>1209</td>
      <td>yes</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>555</th>
      <td>24.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>secondary</td>
      <td>no</td>
      <td>597</td>
      <td>yes</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>success</td>
    </tr>
    <tr>
      <th>606</th>
      <td>23.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>tertiary</td>
      <td>no</td>
      <td>113</td>
      <td>no</td>
      <td>NaN</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>success</td>
    </tr>
    <tr>
      <th>1726</th>
      <td>27.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>secondary</td>
      <td>no</td>
      <td>111</td>
      <td>no</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>success</td>
    </tr>
    <tr>
      <th>2860</th>
      <td>26.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>secondary</td>
      <td>no</td>
      <td>655</td>
      <td>no</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>success</td>
    </tr>
    <tr>
      <th>3258</th>
      <td>18.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>unknown</td>
      <td>no</td>
      <td>108</td>
      <td>no</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>success</td>
    </tr>
    <tr>
      <th>3272</th>
      <td>33.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>unknown</td>
      <td>no</td>
      <td>1170</td>
      <td>no</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>success</td>
    </tr>
    <tr>
      <th>3291</th>
      <td>23.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>secondary</td>
      <td>no</td>
      <td>480</td>
      <td>no</td>
      <td>no</td>
      <td>182.0</td>
      <td>1</td>
      <td>failure</td>
      <td>success</td>
    </tr>
    <tr>
      <th>3321</th>
      <td>22.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>unknown</td>
      <td>no</td>
      <td>3317</td>
      <td>no</td>
      <td>NaN</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>3422</th>
      <td>19.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>unknown</td>
      <td>no</td>
      <td>60</td>
      <td>no</td>
      <td>NaN</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>4375</th>
      <td>27.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>tertiary</td>
      <td>no</td>
      <td>118</td>
      <td>no</td>
      <td>no</td>
      <td>98.0</td>
      <td>1</td>
      <td>failure</td>
      <td>success</td>
    </tr>
    <tr>
      <th>4399</th>
      <td>26.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>tertiary</td>
      <td>no</td>
      <td>294</td>
      <td>no</td>
      <td>no</td>
      <td>91.0</td>
      <td>2</td>
      <td>success</td>
      <td>success</td>
    </tr>
    <tr>
      <th>4909</th>
      <td>28.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>secondary</td>
      <td>no</td>
      <td>205</td>
      <td>no</td>
      <td>no</td>
      <td>184.0</td>
      <td>2</td>
      <td>other</td>
      <td>success</td>
    </tr>
    <tr>
      <th>5128</th>
      <td>30.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>unknown</td>
      <td>no</td>
      <td>1232</td>
      <td>yes</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>5226</th>
      <td>28.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>secondary</td>
      <td>no</td>
      <td>1377</td>
      <td>yes</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>success</td>
    </tr>
    <tr>
      <th>5336</th>
      <td>27.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>secondary</td>
      <td>no</td>
      <td>672</td>
      <td>no</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>5345</th>
      <td>22.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>unknown</td>
      <td>no</td>
      <td>47</td>
      <td>no</td>
      <td>NaN</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>5379</th>
      <td>26.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>tertiary</td>
      <td>no</td>
      <td>37</td>
      <td>yes</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>5429</th>
      <td>20.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>unknown</td>
      <td>no</td>
      <td>167</td>
      <td>no</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>5557</th>
      <td>25.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>unknown</td>
      <td>no</td>
      <td>3</td>
      <td>no</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>success</td>
    </tr>
    <tr>
      <th>5561</th>
      <td>27.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>tertiary</td>
      <td>no</td>
      <td>0</td>
      <td>no</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>success</td>
    </tr>
    <tr>
      <th>5567</th>
      <td>21.0</td>
      <td>student</td>
      <td>NaN</td>
      <td>unknown</td>
      <td>no</td>
      <td>137</td>
      <td>yes</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-f96d4cfb-f5cf-4a48-a618-031ed85d9db7')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-f96d4cfb-f5cf-4a48-a618-031ed85d9db7 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-f96d4cfb-f5cf-4a48-a618-031ed85d9db7');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># df.loc[条件文, 列名] = 値で値を代入
df2.loc[(df2[&#39;marital&#39;].isnull()) &amp; (df2[&#39;job&#39;] == &#39;student&#39;), &#39;marital&#39;] = &#39;single&#39; # student は single で補完
df2.loc[(df2[&#39;marital&#39;].isnull()) &amp; (df2[&#39;job&#39;] == &#39;blue-collar&#39;), &#39;marital&#39;] = &#39;married&#39; # mattial は married で補完
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df2.isnull().sum()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
age            0
job            0
marital        0
education      0
default       29
balance        0
housing       61
loan         217
pdays         36
previous       0
poutcome     250
result         0
dtype: int64
</pre></div></div>
</div>
</section>
<section id="Default-の欠損値補完">
<h4>Default の欠損値補完<a class="headerlink" href="#Default-の欠損値補完" title="この見出しへのパーマリンク"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sns.countplot(df2[&#39;default&#39;])
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/seaborn/_decorators.py:43: FutureWarning: Pass the following variable as a keyword arg: x. From version 0.12, the only valid positional argument will be `data`, and passing other arguments without an explicit keyword will result in an error or misinterpretation.
  FutureWarning
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fcb69a5b310&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_58_2.png" src="../_images/src_01_05_bankmarketing_58_2.png" />
</div>
</div>
<p>データを確認してみると、かなり偏りがありそうです。 最頻値で補完を行います。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 最頻値の取得
df2[&#39;default&#39;].mode()[0]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;no&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 欠損値の補完
df2[&#39;default&#39;] = df2[&#39;default&#39;].fillna(df2[&#39;default&#39;].mode()[0])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df2.isnull().sum()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
age            0
job            0
marital        0
education      0
default        0
balance        0
housing       61
loan         217
pdays         36
previous       0
poutcome     250
result         0
dtype: int64
</pre></div></div>
</div>
</section>
<section id="Housing-の欠損値補完">
<h4>Housing の欠損値補完<a class="headerlink" href="#Housing-の欠損値補完" title="この見出しへのパーマリンク"></a></h4>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">Housing</span></code> が表すのは家のローンの有無です。</div>
<div class="line">こちらも年齢と職業が大きく関連していると考えられます。</div>
</div>
<p>では、その仮説を元にどのように欠損値を補完できるか確認します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Uniqueな値の数を確認
df2[&#39;housing&#39;].value_counts()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
yes    3499
no     2856
Name: housing, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sns.countplot(df2[&#39;housing&#39;])
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/seaborn/_decorators.py:43: FutureWarning: Pass the following variable as a keyword arg: x. From version 0.12, the only valid positional argument will be `data`, and passing other arguments without an explicit keyword will result in an error or misinterpretation.
  FutureWarning
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fcb699632d0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_66_2.png" src="../_images/src_01_05_bankmarketing_66_2.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">housing</span></code> と <code class="docutils literal notranslate"><span class="pre">job</span></code> の関係性を確認します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># クロスタブ集計で数値を確認
pd.crosstab(df2[&#39;housing&#39;], df2[&#39;job&#39;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-a069585d-afa5-4808-9d21-28deaf655e5f">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>job</th>
      <th>admin.</th>
      <th>blue-collar</th>
      <th>entrepreneur</th>
      <th>housemaid</th>
      <th>management</th>
      <th>retired</th>
      <th>self-employed</th>
      <th>services</th>
      <th>student</th>
      <th>technician</th>
      <th>unemployed</th>
      <th>unknown</th>
    </tr>
    <tr>
      <th>housing</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>no</th>
      <td>281</td>
      <td>379</td>
      <td>106</td>
      <td>101</td>
      <td>675</td>
      <td>267</td>
      <td>127</td>
      <td>207</td>
      <td>85</td>
      <td>488</td>
      <td>97</td>
      <td>43</td>
    </tr>
    <tr>
      <th>yes</th>
      <td>421</td>
      <td>1036</td>
      <td>136</td>
      <td>58</td>
      <td>649</td>
      <td>51</td>
      <td>98</td>
      <td>386</td>
      <td>30</td>
      <td>553</td>
      <td>71</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-a069585d-afa5-4808-9d21-28deaf655e5f')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-a069585d-afa5-4808-9d21-28deaf655e5f button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-a069585d-afa5-4808-9d21-28deaf655e5f');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># countplotでyesとnoに対応する数をカラムごとに算出
plt.figure(figsize=(15, 6))
sns.countplot(x=&#39;job&#39;, hue=&#39;housing&#39;, data=df2)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fcb6bc61610&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_69_1.png" src="../_images/src_01_05_bankmarketing_69_1.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">housing</span></code> と <code class="docutils literal notranslate"><span class="pre">age</span></code> の関係性も確認します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>pd.crosstab(df2[&#39;housing&#39;], df2[&#39;age&#39;])
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-93588793-465d-4b57-ba1a-4d07e39757b8">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>age</th>
      <th>18.0</th>
      <th>19.0</th>
      <th>20.0</th>
      <th>21.0</th>
      <th>22.0</th>
      <th>23.0</th>
      <th>24.0</th>
      <th>25.0</th>
      <th>26.0</th>
      <th>27.0</th>
      <th>...</th>
      <th>77.0</th>
      <th>78.0</th>
      <th>79.0</th>
      <th>80.0</th>
      <th>81.0</th>
      <th>82.0</th>
      <th>83.0</th>
      <th>84.0</th>
      <th>86.0</th>
      <th>93.0</th>
    </tr>
    <tr>
      <th>housing</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>no</th>
      <td>2</td>
      <td>2</td>
      <td>5</td>
      <td>7</td>
      <td>11</td>
      <td>7</td>
      <td>10</td>
      <td>31</td>
      <td>55</td>
      <td>49</td>
      <td>...</td>
      <td>5</td>
      <td>6</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>yes</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>7</td>
      <td>22</td>
      <td>26</td>
      <td>36</td>
      <td>53</td>
      <td>69</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 70 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-93588793-465d-4b57-ba1a-4d07e39757b8')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-93588793-465d-4b57-ba1a-4d07e39757b8 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-93588793-465d-4b57-ba1a-4d07e39757b8');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.figure(figsize=(15, 6))
sns.countplot(x=&#39;age&#39;, hue=&#39;housing&#39;, data=df2)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fcb6d920910&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_72_1.png" src="../_images/src_01_05_bankmarketing_72_1.png" />
</div>
</div>
<div class="line-block">
<div class="line">感覚的にどのように埋めればいいのかは確認することができました。</div>
<div class="line">実際にどこを補完する必要があるのかも確認しておき、アプローチを考えます。</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>housing_null = df2[df2[&#39;housing&#39;].isnull()][[&#39;housing&#39;, &#39;job&#39;, &#39;age&#39;]]
housing_null.head(2)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-d9bc50c0-6438-465b-a94b-d46ebb47ae6d">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>housing</th>
      <th>job</th>
      <th>age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>23</th>
      <td>NaN</td>
      <td>management</td>
      <td>51.0</td>
    </tr>
    <tr>
      <th>61</th>
      <td>NaN</td>
      <td>admin.</td>
      <td>52.0</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-d9bc50c0-6438-465b-a94b-d46ebb47ae6d')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-d9bc50c0-6438-465b-a94b-d46ebb47ae6d button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-d9bc50c0-6438-465b-a94b-d46ebb47ae6d');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sns.distplot(housing_null[&#39;age&#39;])
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fcb6c1e5910&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_75_2.png" src="../_images/src_01_05_bankmarketing_75_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sns.countplot(&#39;job&#39;, data=housing_null)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/seaborn/_decorators.py:43: FutureWarning: Pass the following variable as a keyword arg: x. From version 0.12, the only valid positional argument will be `data`, and passing other arguments without an explicit keyword will result in an error or misinterpretation.
  FutureWarning
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fcb6954ae10&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_76_2.png" src="../_images/src_01_05_bankmarketing_76_2.png" />
</div>
</div>
<p>上記の可視化した情報から、感覚的に補完を行う値を決めます。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">job</span></code> が <code class="docutils literal notranslate"><span class="pre">student</span></code> もしくは <code class="docutils literal notranslate"><span class="pre">retired</span></code> の場合は、 <code class="docutils literal notranslate"><span class="pre">no</span></code></p></li>
<li><p>その他の値は <code class="docutils literal notranslate"><span class="pre">yes</span></code> で補完（職業の内容と年齢の <code class="docutils literal notranslate"><span class="pre">housing</span></code> のデータをみても <code class="docutils literal notranslate"><span class="pre">yes</span></code> の数の方が多そうな為）</p></li>
</ul>
<p>データフレームの条件抽出は <code class="docutils literal notranslate"><span class="pre">.loc</span></code> 関数を使用します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df2.loc[(df2[&#39;housing&#39;].isnull()) &amp; ((df2[&#39;job&#39;] == &#39;student&#39;) | (df2[&#39;job&#39;] == &#39;retired&#39;))]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-9cc89715-0505-46f1-9245-c3687095098c">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>balance</th>
      <th>housing</th>
      <th>loan</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>167</th>
      <td>51.0</td>
      <td>retired</td>
      <td>married</td>
      <td>secondary</td>
      <td>no</td>
      <td>0</td>
      <td>NaN</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>NaN</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>636</th>
      <td>51.0</td>
      <td>retired</td>
      <td>married</td>
      <td>primary</td>
      <td>no</td>
      <td>229</td>
      <td>NaN</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>2037</th>
      <td>24.0</td>
      <td>student</td>
      <td>single</td>
      <td>unknown</td>
      <td>no</td>
      <td>0</td>
      <td>NaN</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>4094</th>
      <td>54.0</td>
      <td>retired</td>
      <td>married</td>
      <td>secondary</td>
      <td>no</td>
      <td>1614</td>
      <td>NaN</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>4884</th>
      <td>54.0</td>
      <td>retired</td>
      <td>divorced</td>
      <td>tertiary</td>
      <td>no</td>
      <td>349</td>
      <td>NaN</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>4903</th>
      <td>51.0</td>
      <td>retired</td>
      <td>married</td>
      <td>primary</td>
      <td>no</td>
      <td>34</td>
      <td>NaN</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>5382</th>
      <td>54.0</td>
      <td>retired</td>
      <td>divorced</td>
      <td>secondary</td>
      <td>no</td>
      <td>1483</td>
      <td>NaN</td>
      <td>yes</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>5717</th>
      <td>54.0</td>
      <td>retired</td>
      <td>married</td>
      <td>secondary</td>
      <td>no</td>
      <td>1154</td>
      <td>NaN</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>5807</th>
      <td>24.0</td>
      <td>student</td>
      <td>single</td>
      <td>secondary</td>
      <td>no</td>
      <td>486</td>
      <td>NaN</td>
      <td>no</td>
      <td>270.0</td>
      <td>2</td>
      <td>other</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>6032</th>
      <td>54.0</td>
      <td>retired</td>
      <td>married</td>
      <td>secondary</td>
      <td>no</td>
      <td>529</td>
      <td>NaN</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-9cc89715-0505-46f1-9245-c3687095098c')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-9cc89715-0505-46f1-9245-c3687095098c button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-9cc89715-0505-46f1-9245-c3687095098c');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># jobがstudent or retiredの場合、noで補完
df2.loc[(df2[&#39;housing&#39;].isnull()) &amp; ((df2[&#39;job&#39;] == &#39;student&#39;) | (df2[&#39;job&#39;] == &#39;retired&#39;)), &#39;housing&#39;] = &#39;no&#39;
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># その他の値をyesで補完
df2 = df2.fillna({&#39;housing&#39;:&#39;yes&#39;})
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df2.isnull().sum()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
age            0
job            0
marital        0
education      0
default        0
balance        0
housing        0
loan         217
pdays         36
previous       0
poutcome     250
result         0
dtype: int64
</pre></div></div>
</div>
</section>
<section id="PDays-の欠損値補完">
<h4>PDays の欠損値補完<a class="headerlink" href="#PDays-の欠損値補完" title="この見出しへのパーマリンク"></a></h4>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">pdays</span></code> が表しているのは前回のキャンペーンで通話してからの経過日数（単位：日）です。</div>
<div class="line">まずは分布を確認してみます。</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 分布を確認 -&gt; 偏りがあり、最小値で補完してもよさそう
sns.distplot(df2[&#39;pdays&#39;].dropna())
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/seaborn/distributions.py:2619: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fcb694c18d0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_86_2.png" src="../_images/src_01_05_bankmarketing_86_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 最小値の確認
df2[&#39;pdays&#39;].describe()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
count    6380.000000
mean       39.616458
std        97.745220
min        -1.000000
25%        -1.000000
50%        -1.000000
75%        -1.000000
max       838.000000
Name: pdays, dtype: float64
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 最小値で補完
df2 = df2.fillna({&#39;pdays&#39;:df2[&#39;pdays&#39;].min()})
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df2.isnull().sum()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
age            0
job            0
marital        0
education      0
default        0
balance        0
housing        0
loan         217
pdays          0
previous       0
poutcome     250
result         0
dtype: int64
</pre></div></div>
</div>
</section>
<section id="Poutcome-の欠損値補完">
<h4>Poutcome の欠損値補完<a class="headerlink" href="#Poutcome-の欠損値補完" title="この見出しへのパーマリンク"></a></h4>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">poutcome</span></code> は前回キャンペーンの成約状況を表す変数です。</div>
<div class="line">中身を確認し、アプローチを確認します。</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df2[&#39;poutcome&#39;].value_counts()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
unknown    4998
failure     695
other       253
success     220
Name: poutcome, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sns.countplot(df2[&#39;poutcome&#39;])
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/seaborn/_decorators.py:43: FutureWarning: Pass the following variable as a keyword arg: x. From version 0.12, the only valid positional argument will be `data`, and passing other arguments without an explicit keyword will result in an error or misinterpretation.
  FutureWarning
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fcb69360d90&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_93_2.png" src="../_images/src_01_05_bankmarketing_93_2.png" />
</div>
</div>
<p>変数の中に unknown があり、かつ数も最も多いのでこちらで補完します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df2 = df2.fillna({&#39;poutcome&#39;:&#39;unknown&#39;})
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df2.isnull().sum()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
age            0
job            0
marital        0
education      0
default        0
balance        0
housing        0
loan         217
pdays          0
previous       0
poutcome       0
result         0
dtype: int64
</pre></div></div>
</div>
</section>
<section id="Loan-の欠損値補完">
<h4>Loan の欠損値補完<a class="headerlink" href="#Loan-の欠損値補完" title="この見出しへのパーマリンク"></a></h4>
<p>中身を確認し、アプローチを方法を考えます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>sns.countplot(df2[&#39;loan&#39;])
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/local/lib/python3.7/dist-packages/seaborn/_decorators.py:43: FutureWarning: Pass the following variable as a keyword arg: x. From version 0.12, the only valid positional argument will be `data`, and passing other arguments without an explicit keyword will result in an error or misinterpretation.
  FutureWarning
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fcb69392f90&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_98_2.png" src="../_images/src_01_05_bankmarketing_98_2.png" />
</div>
</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">loan</span></code> の中身は <code class="docutils literal notranslate"><span class="pre">yes</span></code> か <code class="docutils literal notranslate"><span class="pre">no</span></code> のどちらかの文字列が入っています。</div>
<div class="line">比率としては圧倒的に <code class="docutils literal notranslate"><span class="pre">no</span></code> が多いようなので、 <code class="docutils literal notranslate"><span class="pre">no</span></code> で補完します。</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df2 = df2.fillna({&#39;loan&#39;:&#39;no&#39;})
df2.isnull().sum()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
age          0
job          0
marital      0
education    0
default      0
balance      0
housing      0
loan         0
pdays        0
previous     0
poutcome     0
result       0
dtype: int64
</pre></div></div>
</div>
<div class="line-block">
<div class="line">欠損値の補完が完了しました。</div>
<div class="line">ここで精度が出るか確認してみましょう。</div>
</div>
</section>
</section>
<section id="精度の検証（1）">
<h3>精度の検証（1）<a class="headerlink" href="#精度の検証（1）" title="この見出しへのパーマリンク"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sklearn.preprocessing import LabelEncoder

le = LabelEncoder()
df2[&#39;result&#39;] = le.fit_transform(df2[&#39;result&#39;])
df2_dum = pd.get_dummies(df2)
df2_dum.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(6416, 34)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>t = df2_dum[&#39;result&#39;].values
x = df2_dum.drop([&#39;result&#39;], axis=1).values
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sklearn.model_selection import train_test_split
x_train, x_val, t_train, t_val = train_test_split(x, t, test_size=0.3, random_state=1)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの宣言
model = DecisionTreeClassifier(random_state=0)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの学習
model.fit(x_train, t_train)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DecisionTreeClassifier(random_state=0)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの検証
print(model.score(x_train, t_train))
print(model.score(x_val, t_val))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9991093297706524
0.828051948051948
</pre></div></div>
</div>
<div class="line-block">
<div class="line">わずかに精度が上がりました。</div>
<div class="line">全体のサンプル数に対して、欠損値の数が多くなかった為影響が大きくなかったことが推測されます。</div>
<div class="line">続いてはEncodingの方法について確認します。</div>
</div>
</section>
<section id="カテゴリカル変数へのアプローチ">
<h3>カテゴリカル変数へのアプローチ<a class="headerlink" href="#カテゴリカル変数へのアプローチ" title="この見出しへのパーマリンク"></a></h3>
<section id="Label-Encoding">
<h4>Label Encoding<a class="headerlink" href="#Label-Encoding" title="この見出しへのパーマリンク"></a></h4>
<p>まずは2値のものに関してはLabel Encodingを適用させます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df3 = df2.copy()
df_obj = df3.select_dtypes(include=&#39;object&#39;)
df_obj.head(2)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-7ef89234-8350-47c1-8e82-6719cd6f65ff">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>housing</th>
      <th>loan</th>
      <th>poutcome</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>entrepreneur</td>
      <td>married</td>
      <td>secondary</td>
      <td>no</td>
      <td>no</td>
      <td>yes</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>1</th>
      <td>technician</td>
      <td>single</td>
      <td>secondary</td>
      <td>no</td>
      <td>yes</td>
      <td>no</td>
      <td>unknown</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-7ef89234-8350-47c1-8e82-6719cd6f65ff')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-7ef89234-8350-47c1-8e82-6719cd6f65ff button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-7ef89234-8350-47c1-8e82-6719cd6f65ff');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># カテゴリカル変数のそれぞれのUnique数を確認
str_uni = df_obj.nunique() # Uniqueの数を変数に格納
str_uni
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
job          12
marital       3
education     4
default       2
housing       2
loan          2
poutcome      4
dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>col_le = str_uni[str_uni == 2].index
col_le
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Index([&#39;default&#39;, &#39;housing&#39;, &#39;loan&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df3[col_le[0]].unique()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;no&#39;, &#39;yes&#39;], dtype=object)
</pre></div></div>
</div>
<p>文字列が2値の列名が取得できたので、Label Encodingを適用します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>for col in col_le:
    le = LabelEncoder()
    df3[col] = le.fit_transform(df3[col])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df3.head(10)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-5968c677-d38d-4ab7-a66b-4d7898e4cab9">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>balance</th>
      <th>housing</th>
      <th>loan</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50.0</td>
      <td>entrepreneur</td>
      <td>married</td>
      <td>secondary</td>
      <td>0</td>
      <td>1857</td>
      <td>0</td>
      <td>1</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>37.0</td>
      <td>technician</td>
      <td>single</td>
      <td>secondary</td>
      <td>0</td>
      <td>363</td>
      <td>1</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>35.0</td>
      <td>blue-collar</td>
      <td>married</td>
      <td>primary</td>
      <td>0</td>
      <td>422</td>
      <td>1</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>55.0</td>
      <td>retired</td>
      <td>married</td>
      <td>secondary</td>
      <td>0</td>
      <td>119</td>
      <td>0</td>
      <td>1</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>40.0</td>
      <td>blue-collar</td>
      <td>single</td>
      <td>secondary</td>
      <td>0</td>
      <td>1066</td>
      <td>1</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>59.0</td>
      <td>retired</td>
      <td>married</td>
      <td>secondary</td>
      <td>0</td>
      <td>1080</td>
      <td>0</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>40.0</td>
      <td>technician</td>
      <td>married</td>
      <td>secondary</td>
      <td>0</td>
      <td>3056</td>
      <td>0</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>43.0</td>
      <td>management</td>
      <td>single</td>
      <td>tertiary</td>
      <td>0</td>
      <td>-2</td>
      <td>0</td>
      <td>1</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>59.0</td>
      <td>unknown</td>
      <td>married</td>
      <td>primary</td>
      <td>0</td>
      <td>282</td>
      <td>0</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>25.0</td>
      <td>entrepreneur</td>
      <td>single</td>
      <td>tertiary</td>
      <td>1</td>
      <td>6</td>
      <td>1</td>
      <td>1</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-5968c677-d38d-4ab7-a66b-4d7898e4cab9')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-5968c677-d38d-4ab7-a66b-4d7898e4cab9 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-5968c677-d38d-4ab7-a66b-4d7898e4cab9');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
</section>
</section>
<section id="精度の検証(2)">
<h3>精度の検証(2)<a class="headerlink" href="#精度の検証(2)" title="この見出しへのパーマリンク"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df3.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-aa8f4cf9-b841-4798-a42b-7dbfa0f1d662">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>balance</th>
      <th>housing</th>
      <th>loan</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50.0</td>
      <td>entrepreneur</td>
      <td>married</td>
      <td>secondary</td>
      <td>0</td>
      <td>1857</td>
      <td>0</td>
      <td>1</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>37.0</td>
      <td>technician</td>
      <td>single</td>
      <td>secondary</td>
      <td>0</td>
      <td>363</td>
      <td>1</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>35.0</td>
      <td>blue-collar</td>
      <td>married</td>
      <td>primary</td>
      <td>0</td>
      <td>422</td>
      <td>1</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-aa8f4cf9-b841-4798-a42b-7dbfa0f1d662')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-aa8f4cf9-b841-4798-a42b-7dbfa0f1d662 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-aa8f4cf9-b841-4798-a42b-7dbfa0f1d662');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df3_dum = pd.get_dummies(df3)
df3_dum.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(6416, 31)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>t = df3_dum[&#39;result&#39;].values
x = df3_dum.drop([&#39;result&#39;], axis=1).values
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sklearn.model_selection import train_test_split
x_train, x_val, t_train, t_val = train_test_split(x, t, test_size=0.3, random_state=1)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの宣言
model = DecisionTreeClassifier(random_state=0)

# モデルの学習
model.fit(x_train, t_train)

# モデルの検証
print(model.score(x_train, t_train))
print(model.score(x_val, t_val))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9991093297706524
0.8296103896103896
</pre></div></div>
</div>
<div class="line-block">
<div class="line">少し精度に変動がありましたが、大きくは変わりませんでした。</div>
<div class="line">Encodingの方法はアルゴリズムによって、変更すると精度にも影響が出るため、検証する上で複数のEncodingを行うことをオススメします。</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">df3</span></code> のデータを用いてハイパーパラメータの調整を行います。</p>
</section>
</section>
<section id="モデルへのアプローチ">
<h2>モデルへのアプローチ<a class="headerlink" href="#モデルへのアプローチ" title="この見出しへのパーマリンク"></a></h2>
<div class="line-block">
<div class="line">ハイパーパラメータのチューニングを行なっていきます。</div>
<div class="line">今回はグリッドサーチを用います。</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df3_dum.head(3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-d6df3211-9e1c-4a68-bcfb-c93220add486">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>default</th>
      <th>balance</th>
      <th>housing</th>
      <th>loan</th>
      <th>pdays</th>
      <th>previous</th>
      <th>result</th>
      <th>job_admin.</th>
      <th>job_blue-collar</th>
      <th>...</th>
      <th>marital_married</th>
      <th>marital_single</th>
      <th>education_primary</th>
      <th>education_secondary</th>
      <th>education_tertiary</th>
      <th>education_unknown</th>
      <th>poutcome_failure</th>
      <th>poutcome_other</th>
      <th>poutcome_success</th>
      <th>poutcome_unknown</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50.0</td>
      <td>0</td>
      <td>1857</td>
      <td>0</td>
      <td>1</td>
      <td>-1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>37.0</td>
      <td>0</td>
      <td>363</td>
      <td>1</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>35.0</td>
      <td>0</td>
      <td>422</td>
      <td>1</td>
      <td>0</td>
      <td>-1.0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 31 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-d6df3211-9e1c-4a68-bcfb-c93220add486')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-d6df3211-9e1c-4a68-bcfb-c93220add486 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-d6df3211-9e1c-4a68-bcfb-c93220add486');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>t = df3_dum[&#39;result&#39;].values
x = df3_dum.drop([&#39;result&#39;], axis=1).values
</pre></div>
</div>
</div>
<p>K-分割交差検証を用いて精度を計測するため、データはこのまま使用します。</p>
<section id="Grid-Search-の適用">
<h3>Grid Search の適用<a class="headerlink" href="#Grid-Search-の適用" title="この見出しへのパーマリンク"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from sklearn.model_selection import GridSearchCV

estimator = DecisionTreeClassifier(random_state=0)

# チューニングを行うハイパーパラメータとその範囲の指定
max_depth = np.linspace(2, 15, 10, dtype=int)
min_samples_split = np.linspace(2, 20, 3, dtype=int)

param_grid = [
    {&#39;max_depth&#39;: max_depth, &#39;min_samples_split&#39;: min_samples_split}
]

cv = 5

print(&#39;max_depth:{}, min_samples_leaf:{}, cv:{}&#39;.format(max_depth, min_samples_split, cv))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
max_depth:[ 2  3  4  6  7  9 10 12 13 15], min_samples_leaf:[ 2 11 20], cv:5
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの宣言
tuned_model = GridSearchCV(estimator=estimator, param_grid=param_grid, cv=cv, return_train_score=False)

# モデルの学習
tuned_model.fit(x, t)

# 精度の確認
pd.DataFrame(tuned_model.cv_results_).T
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-621660fe-aaf0-4053-930f-8d8581326557">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>20</th>
      <th>21</th>
      <th>22</th>
      <th>23</th>
      <th>24</th>
      <th>25</th>
      <th>26</th>
      <th>27</th>
      <th>28</th>
      <th>29</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean_fit_time</th>
      <td>0.010106</td>
      <td>0.010713</td>
      <td>0.020085</td>
      <td>0.028801</td>
      <td>0.045261</td>
      <td>0.035878</td>
      <td>0.015709</td>
      <td>0.021598</td>
      <td>0.028921</td>
      <td>0.053411</td>
      <td>...</td>
      <td>0.076656</td>
      <td>0.092164</td>
      <td>0.057605</td>
      <td>0.075254</td>
      <td>0.070575</td>
      <td>0.08549</td>
      <td>0.081503</td>
      <td>0.088049</td>
      <td>0.097397</td>
      <td>0.082312</td>
    </tr>
    <tr>
      <th>std_fit_time</th>
      <td>0.001362</td>
      <td>0.003967</td>
      <td>0.004629</td>
      <td>0.004817</td>
      <td>0.012098</td>
      <td>0.007369</td>
      <td>0.002889</td>
      <td>0.012366</td>
      <td>0.006736</td>
      <td>0.007179</td>
      <td>...</td>
      <td>0.023618</td>
      <td>0.012283</td>
      <td>0.02178</td>
      <td>0.012677</td>
      <td>0.008834</td>
      <td>0.023727</td>
      <td>0.021405</td>
      <td>0.011178</td>
      <td>0.019122</td>
      <td>0.015422</td>
    </tr>
    <tr>
      <th>mean_score_time</th>
      <td>0.006602</td>
      <td>0.000751</td>
      <td>0.001572</td>
      <td>0.001519</td>
      <td>0.004177</td>
      <td>0.005508</td>
      <td>0.000803</td>
      <td>0.000834</td>
      <td>0.002345</td>
      <td>0.002348</td>
      <td>...</td>
      <td>0.002191</td>
      <td>0.010206</td>
      <td>0.004391</td>
      <td>0.005832</td>
      <td>0.004736</td>
      <td>0.001897</td>
      <td>0.003377</td>
      <td>0.007311</td>
      <td>0.003971</td>
      <td>0.002248</td>
    </tr>
    <tr>
      <th>std_score_time</th>
      <td>0.011625</td>
      <td>0.000036</td>
      <td>0.001467</td>
      <td>0.001341</td>
      <td>0.00469</td>
      <td>0.004911</td>
      <td>0.000035</td>
      <td>0.000072</td>
      <td>0.002777</td>
      <td>0.002697</td>
      <td>...</td>
      <td>0.002047</td>
      <td>0.006694</td>
      <td>0.004131</td>
      <td>0.004935</td>
      <td>0.003238</td>
      <td>0.001378</td>
      <td>0.004445</td>
      <td>0.012061</td>
      <td>0.004586</td>
      <td>0.002053</td>
    </tr>
    <tr>
      <th>param_max_depth</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>6</td>
      <td>...</td>
      <td>10</td>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>13</td>
      <td>13</td>
      <td>13</td>
      <td>15</td>
      <td>15</td>
      <td>15</td>
    </tr>
    <tr>
      <th>param_min_samples_split</th>
      <td>2</td>
      <td>11</td>
      <td>20</td>
      <td>2</td>
      <td>11</td>
      <td>20</td>
      <td>2</td>
      <td>11</td>
      <td>20</td>
      <td>2</td>
      <td>...</td>
      <td>20</td>
      <td>2</td>
      <td>11</td>
      <td>20</td>
      <td>2</td>
      <td>11</td>
      <td>20</td>
      <td>2</td>
      <td>11</td>
      <td>20</td>
    </tr>
    <tr>
      <th>params</th>
      <td>{'max_depth': 2, 'min_samples_split': 2}</td>
      <td>{'max_depth': 2, 'min_samples_split': 11}</td>
      <td>{'max_depth': 2, 'min_samples_split': 20}</td>
      <td>{'max_depth': 3, 'min_samples_split': 2}</td>
      <td>{'max_depth': 3, 'min_samples_split': 11}</td>
      <td>{'max_depth': 3, 'min_samples_split': 20}</td>
      <td>{'max_depth': 4, 'min_samples_split': 2}</td>
      <td>{'max_depth': 4, 'min_samples_split': 11}</td>
      <td>{'max_depth': 4, 'min_samples_split': 20}</td>
      <td>{'max_depth': 6, 'min_samples_split': 2}</td>
      <td>...</td>
      <td>{'max_depth': 10, 'min_samples_split': 20}</td>
      <td>{'max_depth': 12, 'min_samples_split': 2}</td>
      <td>{'max_depth': 12, 'min_samples_split': 11}</td>
      <td>{'max_depth': 12, 'min_samples_split': 20}</td>
      <td>{'max_depth': 13, 'min_samples_split': 2}</td>
      <td>{'max_depth': 13, 'min_samples_split': 11}</td>
      <td>{'max_depth': 13, 'min_samples_split': 20}</td>
      <td>{'max_depth': 15, 'min_samples_split': 2}</td>
      <td>{'max_depth': 15, 'min_samples_split': 11}</td>
      <td>{'max_depth': 15, 'min_samples_split': 20}</td>
    </tr>
    <tr>
      <th>split0_test_score</th>
      <td>0.899533</td>
      <td>0.899533</td>
      <td>0.899533</td>
      <td>0.899533</td>
      <td>0.899533</td>
      <td>0.899533</td>
      <td>0.898754</td>
      <td>0.898754</td>
      <td>0.898754</td>
      <td>0.898754</td>
      <td>...</td>
      <td>0.894081</td>
      <td>0.884735</td>
      <td>0.890187</td>
      <td>0.89486</td>
      <td>0.888629</td>
      <td>0.888629</td>
      <td>0.895639</td>
      <td>0.878505</td>
      <td>0.880841</td>
      <td>0.890187</td>
    </tr>
    <tr>
      <th>split1_test_score</th>
      <td>0.899454</td>
      <td>0.899454</td>
      <td>0.899454</td>
      <td>0.898675</td>
      <td>0.898675</td>
      <td>0.898675</td>
      <td>0.898675</td>
      <td>0.898675</td>
      <td>0.898675</td>
      <td>0.893219</td>
      <td>...</td>
      <td>0.893219</td>
      <td>0.886204</td>
      <td>0.89244</td>
      <td>0.890881</td>
      <td>0.883087</td>
      <td>0.888542</td>
      <td>0.89166</td>
      <td>0.872954</td>
      <td>0.885425</td>
      <td>0.889322</td>
    </tr>
    <tr>
      <th>split2_test_score</th>
      <td>0.893998</td>
      <td>0.893998</td>
      <td>0.893998</td>
      <td>0.894778</td>
      <td>0.894778</td>
      <td>0.894778</td>
      <td>0.890881</td>
      <td>0.890881</td>
      <td>0.890881</td>
      <td>0.886204</td>
      <td>...</td>
      <td>0.882307</td>
      <td>0.877631</td>
      <td>0.881528</td>
      <td>0.883866</td>
      <td>0.879189</td>
      <td>0.880748</td>
      <td>0.886204</td>
      <td>0.870616</td>
      <td>0.872954</td>
      <td>0.879969</td>
    </tr>
    <tr>
      <th>split3_test_score</th>
      <td>0.894778</td>
      <td>0.894778</td>
      <td>0.894778</td>
      <td>0.894778</td>
      <td>0.894778</td>
      <td>0.893219</td>
      <td>0.894778</td>
      <td>0.895557</td>
      <td>0.893998</td>
      <td>0.896337</td>
      <td>...</td>
      <td>0.890881</td>
      <td>0.884645</td>
      <td>0.890101</td>
      <td>0.889322</td>
      <td>0.886984</td>
      <td>0.888542</td>
      <td>0.89166</td>
      <td>0.883087</td>
      <td>0.887763</td>
      <td>0.889322</td>
    </tr>
    <tr>
      <th>split4_test_score</th>
      <td>0.893998</td>
      <td>0.893998</td>
      <td>0.893998</td>
      <td>0.894778</td>
      <td>0.893998</td>
      <td>0.893998</td>
      <td>0.886204</td>
      <td>0.886204</td>
      <td>0.886204</td>
      <td>0.885425</td>
      <td>...</td>
      <td>0.880748</td>
      <td>0.871395</td>
      <td>0.876072</td>
      <td>0.87841</td>
      <td>0.871395</td>
      <td>0.872954</td>
      <td>0.879969</td>
      <td>0.859704</td>
      <td>0.868277</td>
      <td>0.872954</td>
    </tr>
    <tr>
      <th>mean_test_score</th>
      <td>0.896352</td>
      <td>0.896352</td>
      <td>0.896352</td>
      <td>0.896508</td>
      <td>0.896352</td>
      <td>0.896041</td>
      <td>0.893858</td>
      <td>0.894014</td>
      <td>0.893702</td>
      <td>0.891988</td>
      <td>...</td>
      <td>0.888247</td>
      <td>0.880922</td>
      <td>0.886065</td>
      <td>0.887468</td>
      <td>0.881857</td>
      <td>0.883883</td>
      <td>0.889026</td>
      <td>0.872973</td>
      <td>0.879052</td>
      <td>0.884351</td>
    </tr>
    <tr>
      <th>std_test_score</th>
      <td>0.002581</td>
      <td>0.002581</td>
      <td>0.002581</td>
      <td>0.002137</td>
      <td>0.002281</td>
      <td>0.002564</td>
      <td>0.004805</td>
      <td>0.004845</td>
      <td>0.004786</td>
      <td>0.005343</td>
      <td>...</td>
      <td>0.005607</td>
      <td>0.00562</td>
      <td>0.006235</td>
      <td>0.00574</td>
      <td>0.006168</td>
      <td>0.006248</td>
      <td>0.005433</td>
      <td>0.007931</td>
      <td>0.007389</td>
      <td>0.00682</td>
    </tr>
    <tr>
      <th>rank_test_score</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>2</td>
      <td>6</td>
      <td>8</td>
      <td>7</td>
      <td>9</td>
      <td>10</td>
      <td>...</td>
      <td>19</td>
      <td>28</td>
      <td>24</td>
      <td>22</td>
      <td>27</td>
      <td>26</td>
      <td>17</td>
      <td>30</td>
      <td>29</td>
      <td>25</td>
    </tr>
  </tbody>
</table>
<p>15 rows × 30 columns</p>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-621660fe-aaf0-4053-930f-8d8581326557')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-621660fe-aaf0-4053-930f-8d8581326557 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-621660fe-aaf0-4053-930f-8d8581326557');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 最適なモデルの確認
print(tuned_model.best_params_, tuned_model.best_score_)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;max_depth&#39;: 3, &#39;min_samples_split&#39;: 2} 0.8965082567871738
</pre></div></div>
</div>
<div class="line-block">
<div class="line">先ほどとデータの分割方法が異なるため、厳密には同じ前提ではないですが、精度に向上が見られました。</div>
<div class="line">範囲を大きく確認したので、得られた結果を元にさらにグリッドサーチを適応します。</div>
<div class="line">1度目の結果を max_depth=2 、 min_samples_split=2 が最も良い結果でした。このあたりをもう一度確認して見ます。</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの定義
estimator = DecisionTreeClassifier(random_state=0)

# チューニングを行うハイパーパラメータとその範囲の指定
max_depth = np.linspace(2, 10, 3, dtype=int)
min_samples_split = np.linspace(2, 5, 3, dtype=int)

param_grid = [
    {&#39;max_depth&#39;: max_depth,
    &#39;min_samples_split&#39;: min_samples_split
    }
]

cv = 5

print(&#39;max_depth:{}, min_samples_leaf:{}, cv:{}&#39;.format(max_depth, min_samples_split, cv))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
max_depth:[ 2  6 10], min_samples_leaf:[2 3 5], cv:5
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの宣言
tuned_model = GridSearchCV(estimator=estimator, param_grid=param_grid, cv=cv, return_train_score=False)

# モデルの学習
tuned_model.fit(x_train, t_train)

# 精度の確認
pd.DataFrame(tuned_model.cv_results_).T
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-b9d7f2c0-fa33-4bc4-bca3-c0eeb14cf0a4">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean_fit_time</th>
      <td>0.006421</td>
      <td>0.00818</td>
      <td>0.005482</td>
      <td>0.019164</td>
      <td>0.014957</td>
      <td>0.023851</td>
      <td>0.047985</td>
      <td>0.039717</td>
      <td>0.040567</td>
    </tr>
    <tr>
      <th>std_fit_time</th>
      <td>0.001803</td>
      <td>0.003101</td>
      <td>0.000172</td>
      <td>0.005768</td>
      <td>0.004468</td>
      <td>0.009693</td>
      <td>0.009068</td>
      <td>0.009199</td>
      <td>0.009996</td>
    </tr>
    <tr>
      <th>mean_score_time</th>
      <td>0.002111</td>
      <td>0.000681</td>
      <td>0.000731</td>
      <td>0.001202</td>
      <td>0.000754</td>
      <td>0.001951</td>
      <td>0.000936</td>
      <td>0.000946</td>
      <td>0.003553</td>
    </tr>
    <tr>
      <th>std_score_time</th>
      <td>0.002727</td>
      <td>0.000023</td>
      <td>0.000085</td>
      <td>0.000816</td>
      <td>0.000117</td>
      <td>0.002327</td>
      <td>0.00005</td>
      <td>0.000069</td>
      <td>0.003255</td>
    </tr>
    <tr>
      <th>param_max_depth</th>
      <td>2</td>
      <td>2</td>
      <td>2</td>
      <td>6</td>
      <td>6</td>
      <td>6</td>
      <td>10</td>
      <td>10</td>
      <td>10</td>
    </tr>
    <tr>
      <th>param_min_samples_split</th>
      <td>2</td>
      <td>3</td>
      <td>5</td>
      <td>2</td>
      <td>3</td>
      <td>5</td>
      <td>2</td>
      <td>3</td>
      <td>5</td>
    </tr>
    <tr>
      <th>params</th>
      <td>{'max_depth': 2, 'min_samples_split': 2}</td>
      <td>{'max_depth': 2, 'min_samples_split': 3}</td>
      <td>{'max_depth': 2, 'min_samples_split': 5}</td>
      <td>{'max_depth': 6, 'min_samples_split': 2}</td>
      <td>{'max_depth': 6, 'min_samples_split': 3}</td>
      <td>{'max_depth': 6, 'min_samples_split': 5}</td>
      <td>{'max_depth': 10, 'min_samples_split': 2}</td>
      <td>{'max_depth': 10, 'min_samples_split': 3}</td>
      <td>{'max_depth': 10, 'min_samples_split': 5}</td>
    </tr>
    <tr>
      <th>split0_test_score</th>
      <td>0.884316</td>
      <td>0.884316</td>
      <td>0.884316</td>
      <td>0.887653</td>
      <td>0.888765</td>
      <td>0.887653</td>
      <td>0.889878</td>
      <td>0.888765</td>
      <td>0.887653</td>
    </tr>
    <tr>
      <th>split1_test_score</th>
      <td>0.894209</td>
      <td>0.894209</td>
      <td>0.894209</td>
      <td>0.89755</td>
      <td>0.89755</td>
      <td>0.896437</td>
      <td>0.885301</td>
      <td>0.885301</td>
      <td>0.887528</td>
    </tr>
    <tr>
      <th>split2_test_score</th>
      <td>0.905345</td>
      <td>0.905345</td>
      <td>0.905345</td>
      <td>0.905345</td>
      <td>0.905345</td>
      <td>0.906459</td>
      <td>0.894209</td>
      <td>0.893096</td>
      <td>0.893096</td>
    </tr>
    <tr>
      <th>split3_test_score</th>
      <td>0.899777</td>
      <td>0.899777</td>
      <td>0.899777</td>
      <td>0.896437</td>
      <td>0.896437</td>
      <td>0.896437</td>
      <td>0.888641</td>
      <td>0.891982</td>
      <td>0.889755</td>
    </tr>
    <tr>
      <th>split4_test_score</th>
      <td>0.886414</td>
      <td>0.886414</td>
      <td>0.886414</td>
      <td>0.896437</td>
      <td>0.896437</td>
      <td>0.893096</td>
      <td>0.894209</td>
      <td>0.891982</td>
      <td>0.888641</td>
    </tr>
    <tr>
      <th>mean_test_score</th>
      <td>0.894012</td>
      <td>0.894012</td>
      <td>0.894012</td>
      <td>0.896684</td>
      <td>0.896907</td>
      <td>0.896016</td>
      <td>0.890448</td>
      <td>0.890225</td>
      <td>0.889335</td>
    </tr>
    <tr>
      <th>std_test_score</th>
      <td>0.007918</td>
      <td>0.007918</td>
      <td>0.007918</td>
      <td>0.005612</td>
      <td>0.00526</td>
      <td>0.00613</td>
      <td>0.003417</td>
      <td>0.002856</td>
      <td>0.002044</td>
    </tr>
    <tr>
      <th>rank_test_score</th>
      <td>4</td>
      <td>4</td>
      <td>4</td>
      <td>2</td>
      <td>1</td>
      <td>3</td>
      <td>7</td>
      <td>8</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-b9d7f2c0-fa33-4bc4-bca3-c0eeb14cf0a4')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-b9d7f2c0-fa33-4bc4-bca3-c0eeb14cf0a4 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-b9d7f2c0-fa33-4bc4-bca3-c0eeb14cf0a4');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 最適なモデルの確認
print(tuned_model.best_params_, tuned_model.best_score_)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;max_depth&#39;: 6, &#39;min_samples_split&#39;: 3} 0.896906733787356
</pre></div></div>
</div>
<p>少しだけ精度が向上しました。 Feature Importance を確認してどの入力変数が聞いているのか見てみます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>feature_importance = tuned_model.best_estimator_.feature_importances_

labels = df3_dum.drop(&#39;result&#39;, axis=1).columns.tolist()

plt.figure(figsize=(15, 6))
plt.barh(labels, feature_importance)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;BarContainer object of 30 artists&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/src_01_05_bankmarketing_141_1.png" src="../_images/src_01_05_bankmarketing_141_1.png" />
</div>
</div>
<div class="line-block">
<div class="line">いくつかの特徴量が強い効果がある事が確認できます。</div>
<div class="line">この結果から特徴量エンジニアリングを行い、新たな特徴量の作成など行う事ができそうです。</div>
</div>
</section>
</section>
<section id="手法へのアプローチ">
<h2>手法へのアプローチ<a class="headerlink" href="#手法へのアプローチ" title="この見出しへのパーマリンク"></a></h2>
<p>先ほどまでは決定木のみで精度がどのようになるのか確認してきました。 他の手法でもどのように変化が出るのか確認してみます。 試行する手法は下記の 2 つを使用します。</p>
<ul class="simple">
<li><p>サポートベクターマシン（SVM）</p></li>
<li><p>XGBoost</p></li>
</ul>
<section id="サポートベクターマシン">
<h3>サポートベクターマシン<a class="headerlink" href="#サポートベクターマシン" title="この見出しへのパーマリンク"></a></h3>
<p>データを標準化して、学習を行います。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの定義
from sklearn.preprocessing import StandardScaler
scaler = StandardScaler()

# 標準化の適用
x_transform = scaler.fit_transform(x)
</pre></div>
</div>
</div>
<p>グリッドサーチは行わず、K-分割交差検証を使用して学習を行います。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの定義
from sklearn.svm import SVC
model = SVC(random_state=0)

# モデルの学習&amp;検証
from sklearn.model_selection import cross_val_score
cross_val_score(model, x_transform, t, cv=5).mean()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.8971316739631364
</pre></div></div>
</div>
<div class="line-block">
<div class="line">先ほどの決定木よりいい精度が出ました。</div>
<div class="line">チューニングを行う前に XGBoost の結果も確認しておきます。</div>
</div>
</section>
<section id="XGBoost">
<h3>XGBoost<a class="headerlink" href="#XGBoost" title="この見出しへのパーマリンク"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの宣言
from xgboost import XGBClassifier
model = XGBClassifier(random_state=0)

# モデルの学習&amp;検証
cross_val_score(model, x_transform, t, cv=5).mean()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.8946377624483116
</pre></div></div>
</div>
<div class="line-block">
<div class="line">こちらもいい精度が出ている事が確認できました。</div>
<div class="line">まだチューニングを行なっていないので、まだ精度向上の余地がありそうです。</div>
</div>
</section>
<section id="ハイパーパラメータのチューニング：XGBoost">
<h3>ハイパーパラメータのチューニング：XGBoost<a class="headerlink" href="#ハイパーパラメータのチューニング：XGBoost" title="この見出しへのパーマリンク"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>estimator = XGBClassifier(random_state=0)

# チューニングを行うハイパーパラメータとその範囲の指定
# linspace(start, stop, num) で start から stop　の間の num（要素数）分の間隔を計算
max_depth = np.linspace(2, 15, 3, dtype=int)
n_estimators = np.linspace(80, 200, 3, dtype=int)
param_grid = [
    {&#39;max_depth&#39; : max_depth,  &#39;n_estimators&#39; : n_estimators}
]
cv = 5
print(&#39;max_depth:{}, n_estimators:{}, cv:{}&#39;.format(max_depth, n_estimators, cv))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
max_depth:[ 2  8 15], n_estimators:[ 80 140 200], cv:5
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの定義
tuned_model = GridSearchCV(estimator=estimator, param_grid=param_grid, cv=cv, return_train_score=False, n_jobs=-1)

# モデルの学習
tuned_model.fit(x_transform, t)

# 最適なモデルの確認
print(tuned_model.best_params_, tuned_model.best_score_)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;max_depth&#39;: 8, &#39;n_estimators&#39;: 80} 0.8947940113101354
</pre></div></div>
</div>
</section>
<section id="ハイパーパラメータチューニング：SVM">
<h3>ハイパーパラメータチューニング：SVM<a class="headerlink" href="#ハイパーパラメータチューニング：SVM" title="この見出しへのパーマリンク"></a></h3>
<div class="line-block">
<div class="line">ハイパーパラメータの探索する範囲が広いので、ベイズ最適化を使用します。</div>
<div class="line">試行する回数はある一定数必要となるので、学習には時間がかかります。</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>!pip install optuna
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Requirement already satisfied: optuna in /usr/local/lib/python3.7/dist-packages (2.10.0)
Requirement already satisfied: PyYAML in /usr/local/lib/python3.7/dist-packages (from optuna) (3.13)
Requirement already satisfied: colorlog in /usr/local/lib/python3.7/dist-packages (from optuna) (6.6.0)
Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from optuna) (4.63.0)
Requirement already satisfied: sqlalchemy&gt;=1.1.0 in /usr/local/lib/python3.7/dist-packages (from optuna) (1.4.32)
Requirement already satisfied: alembic in /usr/local/lib/python3.7/dist-packages (from optuna) (1.7.7)
Requirement already satisfied: cmaes&gt;=0.8.2 in /usr/local/lib/python3.7/dist-packages (from optuna) (0.8.2)
Requirement already satisfied: packaging&gt;=20.0 in /usr/local/lib/python3.7/dist-packages (from optuna) (21.3)
Requirement already satisfied: scipy!=1.4.0 in /usr/local/lib/python3.7/dist-packages (from optuna) (1.4.1)
Requirement already satisfied: cliff in /usr/local/lib/python3.7/dist-packages (from optuna) (3.10.1)
Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from optuna) (1.21.5)
Requirement already satisfied: pyparsing!=3.0.5,&gt;=2.0.2 in /usr/local/lib/python3.7/dist-packages (from packaging&gt;=20.0-&gt;optuna) (3.0.7)
Requirement already satisfied: importlib-metadata in /usr/local/lib/python3.7/dist-packages (from sqlalchemy&gt;=1.1.0-&gt;optuna) (4.11.3)
Requirement already satisfied: greenlet!=0.4.17 in /usr/local/lib/python3.7/dist-packages (from sqlalchemy&gt;=1.1.0-&gt;optuna) (1.1.2)
Requirement already satisfied: importlib-resources in /usr/local/lib/python3.7/dist-packages (from alembic-&gt;optuna) (5.4.0)
Requirement already satisfied: Mako in /usr/local/lib/python3.7/dist-packages (from alembic-&gt;optuna) (1.2.0)
Requirement already satisfied: autopage&gt;=0.4.0 in /usr/local/lib/python3.7/dist-packages (from cliff-&gt;optuna) (0.5.0)
Requirement already satisfied: cmd2&gt;=1.0.0 in /usr/local/lib/python3.7/dist-packages (from cliff-&gt;optuna) (2.4.0)
Requirement already satisfied: PrettyTable&gt;=0.7.2 in /usr/local/lib/python3.7/dist-packages (from cliff-&gt;optuna) (3.2.0)
Requirement already satisfied: stevedore&gt;=2.0.1 in /usr/local/lib/python3.7/dist-packages (from cliff-&gt;optuna) (3.5.0)
Requirement already satisfied: pbr!=2.1.0,&gt;=2.0.0 in /usr/local/lib/python3.7/dist-packages (from cliff-&gt;optuna) (5.8.1)
Requirement already satisfied: wcwidth&gt;=0.1.7 in /usr/local/lib/python3.7/dist-packages (from cmd2&gt;=1.0.0-&gt;cliff-&gt;optuna) (0.2.5)
Requirement already satisfied: pyperclip&gt;=1.6 in /usr/local/lib/python3.7/dist-packages (from cmd2&gt;=1.0.0-&gt;cliff-&gt;optuna) (1.8.2)
Requirement already satisfied: attrs&gt;=16.3.0 in /usr/local/lib/python3.7/dist-packages (from cmd2&gt;=1.0.0-&gt;cliff-&gt;optuna) (21.4.0)
Requirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from cmd2&gt;=1.0.0-&gt;cliff-&gt;optuna) (3.10.0.2)
Requirement already satisfied: zipp&gt;=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata-&gt;sqlalchemy&gt;=1.1.0-&gt;optuna) (3.7.0)
Requirement already satisfied: MarkupSafe&gt;=0.9.2 in /usr/local/lib/python3.7/dist-packages (from Mako-&gt;alembic-&gt;optuna) (2.0.1)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import optuna
from sklearn.model_selection import cross_val_score
from sklearn.svm import SVC

def objective(trial, x, t, cv):
  C = trial.suggest_uniform(&#39;C&#39;, 0.1, 100)
  gamma = trial.suggest_uniform(&#39;gamma&#39;, 1, 200)
  estimator = SVC(
      C = C,
      gamma = gamma
  )
  accuracy = cross_val_score(estimator, x, t, cv=cv).mean()
  return 1 - accuracy
</pre></div>
</div>
</div>
<p>今回は実数値の間で探索範囲を設定するため <code class="docutils literal notranslate"><span class="pre">suggest_uniform</span></code> を使用してしています。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cv = 5
n_trials = 30
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>study = optuna.create_study(sampler=optuna.samplers.RandomSampler(0))
study.optimize(lambda trial: objective(trial, x_transform, t, cv), n_trials=n_trials)
print(study.best_trial)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
<span class="ansi-green-fg">[I 2022-04-13 06:53:24,118]</span> A new study created in memory with name: no-name-c8e4d259-8b51-4860-97fe-ee64c6d3313c
<span class="ansi-green-fg">[I 2022-04-13 06:54:08,923]</span> Trial 0 finished with value: 0.12889741964777846 and parameters: {&#39;C&#39;: 54.92646904233975, &#39;gamma&#39;: 143.3226839081115}. Best is trial 0 with value: 0.12889741964777846.
<span class="ansi-green-fg">[I 2022-04-13 06:54:26,021]</span> Trial 1 finished with value: 0.1304561446959157 and parameters: {&#39;C&#39;: 60.31606126955723, &#39;gamma&#39;: 109.43175341638248}. Best is trial 0 with value: 0.12889741964777846.
<span class="ansi-green-fg">[I 2022-04-13 06:54:43,103]</span> Trial 2 finished with value: 0.12905318288765388 and parameters: {&#39;C&#39;: 42.423114453956586, &#39;gamma&#39;: 129.53292850026457}. Best is trial 0 with value: 0.12889741964777846.
<span class="ansi-green-fg">[I 2022-04-13 06:54:56,161]</span> Trial 3 finished with value: 0.1279621117756038 and parameters: {&#39;C&#39;: 43.814962405142985, &#39;gamma&#39;: 178.46282715563387}. Best is trial 3 with value: 0.1279621117756038.
<span class="ansi-green-fg">[I 2022-04-13 06:55:13,096]</span> Trial 4 finished with value: 0.1365349174321283 and parameters: {&#39;C&#39;: 96.36990977405283, &#39;gamma&#39;: 77.30486224632976}. Best is trial 3 with value: 0.1279621117756038.
<span class="ansi-green-fg">[I 2022-04-13 06:55:26,365]</span> Trial 5 finished with value: 0.13139145256809037 and parameters: {&#39;C&#39;: 79.1933313044582, &#39;gamma&#39;: 106.250089030828}. Best is trial 3 with value: 0.1279621117756038.
<span class="ansi-green-fg">[I 2022-04-13 06:55:39,708]</span> Trial 6 finished with value: 0.1279621117756038 and parameters: {&#39;C&#39;: 56.84765165328384, &#39;gamma&#39;: 185.19373102023954}. Best is trial 3 with value: 0.1279621117756038.
<span class="ansi-green-fg">[I 2022-04-13 06:56:01,265]</span> Trial 7 finished with value: 0.13622181268104594 and parameters: {&#39;C&#39;: 7.196502213968905, &#39;gamma&#39;: 18.338730640606602}. Best is trial 3 with value: 0.1279621117756038.
<span class="ansi-green-fg">[I 2022-04-13 06:56:16,907]</span> Trial 8 finished with value: 0.12484514730127749 and parameters: {&#39;C&#39;: 2.1198179042885394, &#39;gamma&#39;: 166.69134926403967}. Best is trial 8 with value: 0.12484514730127749.
<span class="ansi-green-fg">[I 2022-04-13 06:56:30,770]</span> Trial 9 finished with value: 0.12842976571169107 and parameters: {&#39;C&#39;: 77.83785941989007, &#39;gamma&#39;: 174.132417501117}. Best is trial 8 with value: 0.12484514730127749.
<span class="ansi-green-fg">[I 2022-04-13 06:56:43,936]</span> Trial 10 finished with value: 0.12874153500241603 and parameters: {&#39;C&#39;: 97.86397238905312, &#39;gamma&#39;: 160.032554279128}. Best is trial 8 with value: 0.12484514730127749.
<span class="ansi-green-fg">[I 2022-04-13 06:57:02,333]</span> Trial 11 finished with value: 0.12811799642096633 and parameters: {&#39;C&#39;: 46.2017882890679, &#39;gamma&#39;: 156.32530608100464}. Best is trial 8 with value: 0.12484514730127749.
<span class="ansi-green-fg">[I 2022-04-13 06:57:15,808]</span> Trial 12 finished with value: 0.12749457924500374 and parameters: {&#39;C&#39;: 11.915615144306429, &#39;gamma&#39;: 128.34428324417723}. Best is trial 8 with value: 0.12484514730127749.
<span class="ansi-green-fg">[I 2022-04-13 06:57:31,968]</span> Trial 13 finished with value: 0.12655939277831596 and parameters: {&#39;C&#39;: 14.420993412163735, &#39;gamma&#39;: 188.9891144928672}. Best is trial 8 with value: 0.12484514730127749.
<span class="ansi-green-fg">[I 2022-04-13 06:57:45,308]</span> Trial 14 finished with value: 0.13497619238399083 and parameters: {&#39;C&#39;: 52.232647342832166, &#39;gamma&#39;: 83.51772605811419}. Best is trial 8 with value: 0.12484514730127749.
<span class="ansi-green-fg">[I 2022-04-13 06:58:01,861]</span> Trial 15 finished with value: 0.1279622331810909 and parameters: {&#39;C&#39;: 26.529105649252237, &#39;gamma&#39;: 155.0725041974091}. Best is trial 8 with value: 0.12484514730127749.
<span class="ansi-green-fg">[I 2022-04-13 06:58:15,887]</span> Trial 16 finished with value: 0.13014437540519075 and parameters: {&#39;C&#39;: 45.669418188433205, &#39;gamma&#39;: 114.11835582486106}. Best is trial 8 with value: 0.12484514730127749.
<span class="ansi-green-fg">[I 2022-04-13 06:58:32,352]</span> Trial 17 finished with value: 0.12422148731434057 and parameters: {&#39;C&#39;: 1.9771010635918789, &#39;gamma&#39;: 123.90946391809953}. Best is trial 17 with value: 0.12422148731434057.
<span class="ansi-green-fg">[I 2022-04-13 06:58:45,515]</span> Trial 18 finished with value: 0.12952083682374105 and parameters: {&#39;C&#39;: 61.2483626999699, &#39;gamma&#39;: 123.76986537807663}. Best is trial 17 with value: 0.12422148731434057.
<span class="ansi-green-fg">[I 2022-04-13 06:59:00,318]</span> Trial 19 finished with value: 0.1292090675330163 and parameters: {&#39;C&#39;: 94.38043304361095, &#39;gamma&#39;: 136.6822395215932}. Best is trial 17 with value: 0.12422148731434057.
<span class="ansi-green-fg">[I 2022-04-13 06:59:16,137]</span> Trial 20 finished with value: 0.13326170409597826 and parameters: {&#39;C&#39;: 36.01483926732123, &#39;gamma&#39;: 87.96935880606895}. Best is trial 17 with value: 0.12422148731434057.
<span class="ansi-green-fg">[I 2022-04-13 06:59:39,049]</span> Trial 21 finished with value: 0.14791182562287086 and parameters: {&#39;C&#39;: 69.79335647313376, &#39;gamma&#39;: 12.984868854224697}. Best is trial 17 with value: 0.12422148731434057.
<span class="ansi-green-fg">[I 2022-04-13 06:59:52,224]</span> Trial 22 finished with value: 0.1292090675330163 and parameters: {&#39;C&#39;: 66.7099948730222, &#39;gamma&#39;: 134.4569360540137}. Best is trial 17 with value: 0.12422148731434057.
<span class="ansi-green-fg">[I 2022-04-13 07:00:11,768]</span> Trial 23 finished with value: 0.1413660059780062 and parameters: {&#39;C&#39;: 21.11721785127671, &#39;gamma&#39;: 26.65633323331581}. Best is trial 17 with value: 0.12422148731434057.
<span class="ansi-green-fg">[I 2022-04-13 07:00:25,884]</span> Trial 24 finished with value: 0.1352880830802029 and parameters: {&#39;C&#39;: 31.61129225732597, &#39;gamma&#39;: 73.3784434175819}. Best is trial 17 with value: 0.12422148731434057.
<span class="ansi-green-fg">[I 2022-04-13 07:00:42,611]</span> Trial 25 finished with value: 0.13388512127194097 and parameters: {&#39;C&#39;: 57.06265736474618, &#39;gamma&#39;: 88.28170117900174}. Best is trial 17 with value: 0.12422148731434057.
<span class="ansi-green-fg">[I 2022-04-13 07:01:00,666]</span> Trial 26 finished with value: 0.1476001777376329 and parameters: {&#39;C&#39;: 98.83854642211669, &#39;gamma&#39;: 21.306917338857588}. Best is trial 17 with value: 0.12422148731434057.
<span class="ansi-green-fg">[I 2022-04-13 07:01:19,321]</span> Trial 27 finished with value: 0.13980800936279114 and parameters: {&#39;C&#39;: 20.966787933873988, &#39;gamma&#39;: 33.10059405911426}. Best is trial 17 with value: 0.12422148731434057.
<span class="ansi-green-fg">[I 2022-04-13 07:01:34,621]</span> Trial 28 finished with value: 0.13996389400815357 and parameters: {&#39;C&#39;: 65.3455217139933, &#39;gamma&#39;: 51.40502890541664}. Best is trial 17 with value: 0.12422148731434057.
<span class="ansi-green-fg">[I 2022-04-13 07:01:52,408]</span> Trial 29 finished with value: 0.1394962400720663 and parameters: {&#39;C&#39;: 46.684446208345, &#39;gamma&#39;: 49.640692808318946}. Best is trial 17 with value: 0.12422148731434057.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FrozenTrial(number=17, values=[0.12422148731434057], datetime_start=datetime.datetime(2022, 4, 13, 6, 58, 15, 889780), datetime_complete=datetime.datetime(2022, 4, 13, 6, 58, 32, 352252), params={&#39;C&#39;: 1.9771010635918789, &#39;gamma&#39;: 123.90946391809953}, distributions={&#39;C&#39;: UniformDistribution(high=100.0, low=0.1), &#39;gamma&#39;: UniformDistribution(high=200.0, low=1.0)}, user_attrs={}, system_attrs={}, intermediate_values={}, trial_id=17, state=TrialState.COMPLETE, value=None)
</pre></div></div>
</div>
<div class="line-block">
<div class="line">Cは値が小さくなるほど、精度向上に関連がありそうです。</div>
<div class="line">gammaに関してはどのあたりの値がいいのかはまだわからないです。</div>
<div class="line">Cの値でグリッドサーチを実行し、チューニングしてみます。</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># チューニングするモデルの宣言
estimator = SVC(random_state=0)

# チューニングを行うハイパーパラメータとその範囲の指定
C = np.linspace(0.1, 1, 10, dtype=float)
param_grid = [
    {&#39;C&#39; : C}
]
cv = 5
print(&#39;C:{}, cv:{}&#39;.format(C, cv))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
C:[0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1. ], cv:5
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># モデルの定義
tuned_model = GridSearchCV(estimator=estimator, param_grid=param_grid, cv=cv, return_train_score=False, n_jobs=-1)

# モデルの学習
tuned_model.fit(x_transform, t)

# 最適なモデルの確認
print(tuned_model.best_params_, tuned_model.best_score_)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;C&#39;: 0.5} 0.8980669818353111
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 最適なモデルの引き継ぎ
best_model = tuned_model.best_estimator_
best_model
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SVC(C=0.5, random_state=0)
</pre></div></div>
</div>
<div class="line-block">
<div class="line">少しですが、精度向上ができました。</div>
<div class="line">このようにチューニングを繰り返すことによって、精度向上を行う事ができます。</div>
<div class="line">しかし、あくまでモデルの作成意義は新たなデータに対して、正しく推論できる事です。</div>
</div>
<p>モデルのチューニングも重要ですが、過学習が起きていないかも注意しましょう。</p>
</section>
</section>
<section id="テストデータで評価">
<h2>テストデータで評価<a class="headerlink" href="#テストデータで評価" title="この見出しへのパーマリンク"></a></h2>
<p>テストデータに対して、どれくらいの精度になっていることを確認しましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df_test = pd.read_csv(&#39;/content/bank_test (1).csv&#39;)
df_test.head(2)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
  <div id="df-b782816b-2ece-41b3-aec6-5dab88584520">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>job</th>
      <th>marital</th>
      <th>education</th>
      <th>default</th>
      <th>balance</th>
      <th>housing</th>
      <th>loan</th>
      <th>pdays</th>
      <th>previous</th>
      <th>poutcome</th>
      <th>result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>55.0</td>
      <td>self-employed</td>
      <td>married</td>
      <td>tertiary</td>
      <td>no</td>
      <td>1810</td>
      <td>yes</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
    <tr>
      <th>1</th>
      <td>54.0</td>
      <td>management</td>
      <td>married</td>
      <td>tertiary</td>
      <td>no</td>
      <td>364</td>
      <td>yes</td>
      <td>no</td>
      <td>-1.0</td>
      <td>0</td>
      <td>unknown</td>
      <td>fail</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-b782816b-2ece-41b3-aec6-5dab88584520')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-b782816b-2ece-41b3-aec6-5dab88584520 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-b782816b-2ece-41b3-aec6-5dab88584520');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df_test.isnull().sum()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
age           35
job            8
marital       45
education      0
default       62
balance        0
housing      114
loan          24
pdays         79
previous       0
poutcome     152
result         0
dtype: int64
</pre></div></div>
</div>
<div class="line-block">
<div class="line">推論を行う際には訓練データに適用した前処理と同じ前処理を適用する必要があります。</div>
<div class="line">学習時から下記のように関数にまとめておくと、いいでしょう。</div>
<div class="line">データフレームを関数に渡すと、xとtが取得できる関数を作成しました。</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def prepare_data(df):

    #  Jobの欠損値補完
    df = df.fillna({&#39;job&#39;:&#39;unknown&#39;})

    # Ageの欠損値補完
    df = df.fillna({&#39;age&#39;:df[&#39;age&#39;].mean()})

    #  Maritalの欠損値補完
    marital_null = df[df[&#39;marital&#39;].isnull()][[&#39;job&#39;, &#39;marital&#39;]]
    df.loc[(df[&#39;marital&#39;].isnull()) &amp; (df[&#39;job&#39;] == &#39;student&#39;), &#39;marital&#39;] = &#39;single&#39;
    df.loc[(df[&#39;marital&#39;].isnull()) &amp; (df[&#39;job&#39;] == &#39;blue-collar&#39;), &#39;marital&#39;] = &#39;married&#39;

    # Defaultの欠損値補完
    df[&#39;default&#39;] = df[&#39;default&#39;].fillna(df[&#39;default&#39;].mode()[0])

    # Hosingの欠損値補完
    df.loc[(df[&#39;housing&#39;].isnull()) &amp; ((df[&#39;job&#39;] == &#39;student&#39;) | (df[&#39;job&#39;] == &#39;retired&#39;)), &#39;housing&#39;] = &#39;no&#39;
    df = df.fillna({&#39;housing&#39;:&#39;yes&#39;})

    # Pdaysの欠損値補完
    df = df.fillna({&#39;pdays&#39;:df[&#39;pdays&#39;].min()})

    # Poutcomeの欠損値補完
    df = df.fillna({&#39;poutcome&#39;:&#39;unknown&#39;})

    #  Loanの欠損値補完
    df = df.fillna({&#39;loan&#39;:&#39;no&#39;})

    # Label Encoding
    str_uni = df.select_dtypes(include=&#39;object&#39;).nunique()
    col_le = str_uni[str_uni == 2].index
    for col in col_le:
        le = LabelEncoder()
        df[col] = le.fit_transform(df[col])

    # One-Hot Encoding
    df = pd.get_dummies(df)

    # x, tの切り分け
    t = df[&#39;result&#39;].values
    x = df.drop([&#39;result&#39;], axis=1).values

    # 標準化
    x = scaler.transform(x)

    return x, t
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 関数の実行
x_test, t_test = prepare_data(df_test)

x_test.shape, t_test.shape
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
((15000, 30), (15000,))
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># 欠損値の確認
np.any(np.isnan(x_test))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
False
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># ラベルが0と1であることを確認
np.unique(t_test)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0, 1])
</pre></div></div>
</div>
<section id="Accuracy-の確認">
<h3>Accuracy の確認<a class="headerlink" href="#Accuracy-の確認" title="この見出しへのパーマリンク"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>best_model.score(x_test, t_test)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.8918
</pre></div></div>
</div>
<p>精度を確認する事ができました。</p>
<div class="line-block">
<div class="line">まだこの問題に対して、精度をあげる方法としては、特徴量エンジニアリングなどの前処理、その他の手法の試行など様々な方法が考えられます。</div>
<div class="line">この講義が終わった後も、色々試行錯誤して見てください。</div>
</div>
<p>これで演習課題は終了です。お疲れ様でした。</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01_04_exercise_classification.html" class="btn btn-neutral float-left" title="問題設定：Bank Marketing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="02_00title.html" class="btn btn-neutral float-right" title="– データの前処理と機械学習モデルの構築 –" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, kikagaku.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>